# Codebase Structure

**Analysis Date:** 2026-01-11

## Directory Layout

```
livemathtex/
├── src/
│   └── livemathtex/       # Main package
│       ├── cli.py         # CLI entry point
│       ├── core.py        # Pipeline orchestration
│       ├── config.py      # Configuration loading
│       ├── parser/        # Markdown/LaTeX parsing
│       ├── ir/            # Intermediate Representation
│       ├── engine/        # Evaluation and units
│       ├── render/        # Output generation
│       └── utils/         # Shared utilities
├── tests/                 # Test files
├── docs/                  # Documentation
├── examples/              # Example calculations
├── libs/                  # Local library files
├── utils/                 # Scripts/utilities
├── .cursor/               # Cursor IDE commands
├── .venv/                 # Virtual environment
└── pyproject.toml         # Project configuration
```

## Directory Purposes

**src/livemathtex/**
- Purpose: Main application package
- Contains: All source code modules
- Key files: `cli.py`, `core.py`, `config.py`
- Subdirectories: parser, ir, engine, render, utils

**src/livemathtex/parser/**
- Purpose: Markdown and LaTeX tokenization
- Contains: Lexer, AST models
- Key files: `lexer.py` (18,743 bytes), `models.py`

**src/livemathtex/ir/**
- Purpose: Intermediate Representation layer
- Contains: Schema classes, IR builder
- Key files: `schema.py` (15,083 bytes), `builder.py`

**src/livemathtex/engine/**
- Purpose: Calculation evaluation and unit handling
- Contains: Evaluator, symbol table, Pint backend
- Key files: `evaluator.py` (91,908 bytes), `pint_backend.py` (58,337 bytes), `symbols.py`

**src/livemathtex/render/**
- Purpose: Output generation
- Contains: Markdown renderer
- Key files: `markdown.py`

**tests/**
- Purpose: Test suite
- Contains: Pytest test files
- Key files: `test_examples.py` (snapshot tests), `test_pint_backend.py`, `test_unit_recognition.py`

**docs/**
- Purpose: Project documentation
- Contains: Architecture, usage, roadmap docs
- Key files: `ARCHITECTURE.md`, `USAGE.md`, `SETUP.md`, `ROADMAP.md`

**examples/**
- Purpose: Example Markdown calculations
- Contains: Input/output pairs for testing and demos
- Subdirectories: simple/, engineering/, engineering-units/, custom-units/, etc.

## Key File Locations

**Entry Points:**
- `src/livemathtex/cli.py` - CLI entry point (Click commands)
- `src/livemathtex/__init__.py` - Package initialization

**Configuration:**
- `pyproject.toml` - Project metadata, dependencies, tool configs
- `src/livemathtex/config.py` - Configuration loading logic

**Core Logic:**
- `src/livemathtex/core.py` - Main pipeline (`process_file`, `process_text_v3`)
- `src/livemathtex/engine/evaluator.py` - Calculation evaluation
- `src/livemathtex/engine/pint_backend.py` - Unit handling

**Testing:**
- `tests/test_examples.py` - Snapshot tests for examples
- `tests/test_pint_backend.py` - Unit backend tests
- `tests/test_unit_recognition.py` - Unit recognition tests
- `tests/conftest.py` - Pytest fixtures

**Documentation:**
- `README.md` - Project overview and quick start
- `docs/ARCHITECTURE.md` - Technical design
- `docs/USAGE.md` - Syntax reference

## Naming Conventions

**Files:**
- snake_case.py for all Python modules
- UPPERCASE.md for important docs (README, ARCHITECTURE)
- lowercase.md for other documentation

**Directories:**
- snake_case for all directories
- Singular names (parser, engine, render, ir)

**Special Patterns:**
- `__init__.py` for package initialization
- `conftest.py` for pytest fixtures

## Where to Add New Code

**New Command:**
- Definition: `src/livemathtex/cli.py`
- Handler: `src/livemathtex/core.py` (or new module)
- Tests: `tests/test_*.py`

**New Calculation Operation:**
- Parser: `src/livemathtex/parser/lexer.py`
- Evaluator: `src/livemathtex/engine/evaluator.py`
- Tests: `tests/test_*.py` + new example in `examples/`

**New Unit Support:**
- Backend: `src/livemathtex/engine/pint_backend.py`
- Tests: `tests/test_pint_backend.py`, `tests/test_unit_recognition.py`

**New Example:**
- Location: `examples/<name>/input.md` and `examples/<name>/output.md`
- Auto-discovered by snapshot tests

## Special Directories

**.venv/**
- Purpose: Python virtual environment
- Source: Created by `python -m venv`
- Committed: No (in .gitignore)

**examples/*/output.md**
- Purpose: Expected output for snapshot tests
- Source: Generated by `livemathtex process`
- Committed: Yes (regression test fixtures)

**tools/, scripts/**
- Purpose: Symlinks to proviron shared tooling
- Source: Created by `setup_symlinks.sh`
- Committed: No (symlinks)

---

*Structure analysis: 2026-01-11*
*Update when directory structure changes*
