# Plan 37-02: Parser Extension for Array Literals

## Objective

Extend the expression parser to recognize array literals `[1, 2, 3]` and index access `arr[0]`.

## Files to Modify

1. `src/livemathtex/parser/expression_parser.py`

## Changes

### 1. Add ArrayNode

```python
@dataclass
class ArrayNode(ExprNode):
    """Array literal node."""
    elements: List[ExprNode]
```

### 2. Add IndexNode

```python
@dataclass
class IndexNode(ExprNode):
    """Array index access node."""
    array: ExprNode
    index: ExprNode
```

### 3. Parse Array Literals

In `_primary()`, add case for LBRACKET:

```python
# Array literal: [expr, expr, ...]
if self._check(TokenType.LBRACKET):
    return self._parse_array_literal()

def _parse_array_literal(self) -> ExprNode:
    """Parse [expr, expr, ...]."""
    self._advance()  # consume '['

    elements = []
    if not self._check(TokenType.RBRACKET):
        elements.append(self._expression())
        while self._match_operator(","):
            elements.append(self._expression())

    if not self._check(TokenType.RBRACKET):
        raise ParseError(f"Expected ']' at position {self._current().start}")
    self._advance()  # consume ']'

    node = ArrayNode(elements)
    return self._maybe_attach_unit(node)
```

### 4. Parse Index Access

Modify the variable/expression handling to check for `[` after:

```python
def _maybe_index_access(self, node: ExprNode) -> ExprNode:
    """Check for index access: node[expr]."""
    while self._check(TokenType.LBRACKET):
        self._advance()  # consume '['
        index = self._expression()
        if not self._check(TokenType.RBRACKET):
            raise ParseError(f"Expected ']' at position {self._current().start}")
        self._advance()  # consume ']'
        node = IndexNode(node, index)
    return node
```

## Tests

Create `tests/test_expression_parser_arrays.py`:

```python
def test_parse_array_literal():
    tokens = ExpressionTokenizer("[1, 2, 3]").tokenize()
    tree = ExpressionParser(tokens).parse()
    assert isinstance(tree, ArrayNode)
    assert len(tree.elements) == 3

def test_parse_index_access():
    tokens = ExpressionTokenizer("arr[0]").tokenize()
    tree = ExpressionParser(tokens).parse()
    assert isinstance(tree, IndexNode)
```

## Verification

```bash
pytest tests/test_expression_parser_arrays.py -v
pytest tests/ -k "parser" -v
```

## Estimated Time

45-60 minutes
