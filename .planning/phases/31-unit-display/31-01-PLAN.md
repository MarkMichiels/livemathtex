# Phase 31: Unit Display - Plan 01

**Feature:** Better unit display formatting (ISS-042)

## Objective

Add configurable unit display formatting options to support scientific notation preferences:
- Fraction notation: `mg/(L·d)` instead of `mg/d/L`
- Negative exponents: `mg·L⁻¹·d⁻¹`

## Current State

- Units are formatted using Pint's default string representation
- `format_unit_latex()` in `pint_backend.py` maps Pint names to abbreviations
- No configuration options for unit display format

## Tasks

### Task 1: Add Unit Format Options to Config
**Type:** feat
**Files:** `src/livemathtex/config.py`

Add enum and config option:
```python
class UnitFormat(Enum):
    DEFAULT = "default"     # Pint's format: mg/d/L
    FRACTION = "fraction"   # Parenthesized: mg/(L·d)
    EXPONENT = "exponent"   # Negative exp: mg·L⁻¹·d⁻¹

@dataclass
class LivemathConfig:
    ...
    unit_format: UnitFormat = UnitFormat.DEFAULT
```

### Task 2: Update format_unit_latex() for Fraction Notation
**Type:** feat
**Files:** `src/livemathtex/engine/pint_backend.py`

Modify `format_unit_latex()` to accept format option:
- Parse Pint's unit string to identify numerator/denominator parts
- Reformat as `numerator/(denom₁·denom₂)` for FRACTION mode
- Keep existing behavior for DEFAULT mode

Example transformations:
- `mg / day / liter` → `mg/(L·d)`
- `kilogram / meter ** 2` → `kg/m²`

### Task 3: Add Negative Exponent Formatting
**Type:** feat
**Files:** `src/livemathtex/engine/pint_backend.py`

For EXPONENT mode:
- Convert divisions to negative exponents
- Use Unicode superscripts: `⁻¹`, `⁻²`
- Use middle dot for multiplication: `·`

Example transformations:
- `mg / day / liter` → `mg·L⁻¹·d⁻¹`
- `kilogram / meter ** 2` → `kg·m⁻²`

### Task 4: Thread Config Through Evaluator
**Type:** refactor
**Files:** `src/livemathtex/engine/evaluator.py`

- Pass `config.unit_format` to `format_unit_latex()` calls
- Update `_format_pint_quantity_latex()` and `_format_pint_result()`

### Task 5: Add Tests
**Type:** test
**Files:** `tests/test_unit_display.py`

Test cases:
- Default format unchanged (backward compatibility)
- Fraction format for compound units
- Exponent format for compound units
- Mixed units (numerator with multiple denominators)
- Edge cases: dimensionless, single unit

## Success Criteria

- [ ] UnitFormat enum with 3 options (default, fraction, exponent)
- [ ] `format_unit_latex()` respects format option
- [ ] All existing tests pass (510+ tests)
- [ ] New test coverage for unit formatting

## Implementation Notes

- Use Pint's `unit.dimensionality` to identify numerator/denominator
- Unicode superscripts for exponents: `⁻¹` (U+207B U+00B9), etc.
- Middle dot: `·` (U+00B7) for multiplication in exponent mode
- Keep `\text{}` wrapper for LaTeX output

## Scope Decision

**NOT in scope for this phase:**
- Per-evaluation format override (document-level config only)
- Parsing format from HTML comments (future enhancement)
- Configuring separator character (use standard `·`)

## Dependencies

None - Pint already provides unit decomposition methods.
