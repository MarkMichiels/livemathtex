---
phase: 07-user-documentation
type: execute
---

<objective>
Complete user documentation for v1.4 features (ISS-015)

Purpose: Ensure all features added in v1.2-v1.4 are documented, making the library usable without reading source code.
Output: Updated USAGE.md with complete API documentation, verified examples.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/ISSUES.md (ISS-015 section)

**Key files:**
@docs/USAGE.md - Main documentation file to update
@src/livemathtex/__init__.py - Public API exports

**Features to document (from v1.2-v1.4):**
- `clear_text()` function - clears evaluation results (v1.2)
- `detect_error_markup()` function - detects error markup (v1.4 Phase 6)
- Auto-cleanup behavior in `process_text()` (v1.4 Phase 6)
- Unit redefinition prevention (v1.3 Phase 3)

**Already documented (verified):**
- Inline unit hints `$E == [kJ]$` (lines 499-540)
- HTML comment hints `<!-- [unit] -->` (lines 520-540)
- Custom units `===` syntax (lines 318-401)
- CLI `livemathtex clear` command (lines 900-917)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add clear_text and detect_error_markup to Python API</name>
  <files>docs/USAGE.md</files>
  <action>
In the "Public API" section (after process_file, around line 110), add documentation for:

1. **`clear_text(content: str) -> tuple[str, int]`**
   - Purpose: Remove evaluation results and error markup from processed content
   - Parameters: content - Markdown with LiveMathTeX output
   - Returns: (cleared_content, count) - cleaned content and number of items cleared
   - Use case: Reset document before re-processing, create clean input from output
   - Example code showing usage

2. **`detect_error_markup(content: str) -> dict`**
   - Purpose: Detect existing error markup in content from previous processing
   - Parameters: content - Markdown to check
   - Returns: dict with has_errors, count, has_meta, patterns
   - Use case: Check if document needs cleaning before processing
   - Example code showing usage

Follow the existing documentation style (docstring format, examples with output).
  </action>
  <verify>grep -A5 "clear_text" docs/USAGE.md shows documentation</verify>
  <done>Both functions documented with parameters, returns, and examples</done>
</task>

<task type="auto">
  <name>Task 2: Document auto-cleanup and error messages</name>
  <files>docs/USAGE.md</files>
  <action>
In the "Error Handling" section (around line 940), add:

1. **Auto-cleanup behavior:**
   - Add paragraph explaining that `process_text()` automatically cleans error markup from previous runs
   - Mention this makes processing idempotent - same input always produces same output
   - Reference the `detect_error_markup()` function for inspection

2. **Unit-related errors:**
   - Add "Unit redefinition" to error types table: "Attempting to redefine existing Pint unit"
   - Add "Variable name conflict" error: "Variable name conflicts with Pint unit (e.g., 'a' = year)"
   - Reference the reserved keywords section for best practices

Keep the documentation concise - follow existing style.
  </action>
  <verify>grep -A3 "Auto-cleanup" docs/USAGE.md shows new content</verify>
  <done>Auto-cleanup behavior and unit errors documented</done>
</task>

<task type="auto">
  <name>Task 3: Verify examples and close ISS-015</name>
  <files>examples/, .planning/ISSUES.md</files>
  <action>
1. Run all examples to verify they process correctly:
   ```bash
   cd /home/mark/Repositories/livemathtex
   source ../proviron/venv/bin/activate
   for dir in examples/*/; do
     echo "=== $dir ==="
     livemathtex process "${dir}input.md" -o /tmp/test_output.md 2>&1 | head -5
   done
   ```

2. If any example fails, fix it or note as issue for future

3. Update ISS-015 in ISSUES.md to "Closed" with resolution summary

4. Verify README.md links work (docs/USAGE.md, etc.)
  </action>
  <verify>All examples process without critical errors; ISS-015 marked closed</verify>
  <done>Examples verified working, ISS-015 closed in ISSUES.md</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `clear_text()` documented in Python API section
- [ ] `detect_error_markup()` documented in Python API section
- [ ] Auto-cleanup behavior documented in Error Handling section
- [ ] Unit-related errors documented
- [ ] All examples process successfully
- [ ] ISS-015 marked as closed in ISSUES.md
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- ISS-015 resolved: documentation complete for v1.4 features
- No broken links in documentation
</success_criteria>

<output>
After completion, create `.planning/phases/07-user-documentation/07-01-SUMMARY.md`
</output>
