# Milestone v3.1: Complete SymPy Removal

**Status:** ✅ SHIPPED 2026-01-15
**Phases:** 28
**Total Plans:** 6

## Overview

Complete removal of SymPy and latex2sympy from the codebase. All bugs (ISS-035, ISS-036, ISS-037, ISS-038) were caused by latex2sympy's global state corruption - fixed by removing it entirely.

This milestone completes the Pure Pint Architecture started in v3.0, eliminating all fallback paths to SymPy.

## Phases

### Phase 28: Complete SymPy/latex2sympy Removal

**Goal**: Remove ALL SymPy and latex2sympy code, no fallbacks, clean Pure Pint architecture
**Depends on**: v3.0 complete
**Plans**: 6 plans

Plans:
- [x] 28-01: Remove latex2sympy fallback from evaluator.py (~1000 lines removed)
- [x] 28-02: Remove SymPy from pint_backend.py (~450 lines removed)
- [x] 28-03: Remove SymPy from remaining files, delete token_classifier.py
- [x] 28-04: Simplify internal IDs (v_{0} → v0)
- [x] 28-05: Uninstall packages from dependencies
- [x] 28-06: Full test suite verification and bug fixes

**What was removed:**
- evaluator.py: 106 sympy references → 0
- pint_backend.py: 148 sympy references → 0
- token_classifier.py: DELETE entire file
- core.py: 4 sympy references → 0
- Internal IDs: v_{0} format → v0 format (no LaTeX)
- Dependencies: sympy, latex2sympy2 uninstalled

---

## Milestone Summary

**Key Decisions:**
- Remove SymPy entirely rather than patching around corruption bugs
- Extend custom parser to handle all required LaTeX constructs
- Simplify internal ID format to plain Python strings

**Issues Resolved:**
- ISS-035: Symbol not iterable in tables (caused by latex2sympy)
- ISS-036: Comma subscripts fail with Symbol error (caused by latex2sympy)
- ISS-037: Table cell variables fail (caused by latex2sympy)
- ISS-038: Comma subscripts expression parse error (caused by latex2sympy)

**Parser Extensions Added:**
- Multi-letter unit patterns (kg, kW, MWh, kWh, MPa, etc.)
- Compound unit patterns with division (g/L, m/s, kg/m^3)
- Currency symbols (€, $) as UNIT tokens
- Math functions: \sqrt, \ln, \log, \sin, \cos, \tan, \exp, \abs
- Simple internal ID pattern ([vfx]\d+)

**Technical Debt Addressed:**
- Removed ~1,500 lines of dead SymPy-related code
- Eliminated global state corruption vulnerability
- Simplified variable lookup and name normalization

---

_For current project status, see .planning/ROADMAP.md_
